<div class="container">
  <h2>üë§ Perfil de Usuario Completo</h2>
  <p class="subtitle">Actividad 5: FormGroups Anidados</p>

  <form [formGroup]="perfilForm" (ngSubmit)="onSubmit()">
    
    <!-- ============================================ -->
    <!-- SECCI√ìN: INFORMACI√ìN PERSONAL (FormGroup anidado) -->
    <!-- ============================================ -->
    <div formGroupName="informacionPersonal" class="section">
      <h3>üìã Informaci√≥n Personal</h3>

      <div class="form-row">
        <div class="form-group">
          <label for="nombre">Nombre:</label>
          <input 
            type="text" 
            id="nombre"
            formControlName="nombre"
            class="form-control"
            placeholder="Juan">
          
          <div class="error" *ngIf="informacionPersonal.get('nombre')?.invalid && informacionPersonal.get('nombre')?.touched">
            <small>‚ö†Ô∏è Nombre requerido (m√≠nimo 2 caracteres)</small>
          </div>
        </div>

        <div class="form-group">
          <label for="apellido">Apellido:</label>
          <input 
            type="text" 
            id="apellido"
            formControlName="apellido"
            class="form-control"
            placeholder="P√©rez">
          
          <div class="error" *ngIf="informacionPersonal.get('apellido')?.invalid && informacionPersonal.get('apellido')?.touched">
            <small>‚ö†Ô∏è Apellido requerido (m√≠nimo 2 caracteres)</small>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="fechaNacimiento">Fecha de Nacimiento:</label>
          <input 
            type="date" 
            id="fechaNacimiento"
            formControlName="fechaNacimiento"
            class="form-control">
          
          <div class="info" *ngIf="informacionPersonal.get('fechaNacimiento')?.value">
            üéÇ Edad: {{ calcularEdad() }} a√±os
          </div>
        </div>

        <div class="form-group">
          <label for="telefono">Tel√©fono:</label>
          <input 
            type="tel" 
            id="telefono"
            formControlName="telefono"
            placeholder="612345678"
            class="form-control">
          
          <div class="error" *ngIf="informacionPersonal.get('telefono')?.invalid && informacionPersonal.get('telefono')?.touched">
            <small>‚ö†Ô∏è Tel√©fono inv√°lido (m√≠nimo 9 d√≠gitos)</small>
          </div>
        </div>
      </div>
    </div>

    <!-- ============================================ -->
    <!-- SECCI√ìN: DIRECCIONES (FormArray con FormGroups) -->
    <!-- ============================================ -->
    <div class="section">
      <h3>üè† Direcciones ({{ direcciones.length }})</h3>

      <div formArrayName="direcciones">
        <div *ngFor="let direccion of direcciones.controls; let i = index" [formGroupName]="i" class="direccion-item">
          
          <div class="direccion-header">
            <h4>üìç Direcci√≥n {{ i + 1 }}</h4>
            <button 
              type="button" 
              (click)="eliminarDireccion(i)"
              class="btn-delete-small"
              [disabled]="direcciones.length === 1"
              title="Eliminar direcci√≥n">
              üóëÔ∏è Eliminar
            </button>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Tipo:</label>
              <select formControlName="tipo" class="form-control">
                <option *ngFor="let tipo of tiposDireccion" [value]="tipo">
                  {{ tipo }}
                </option>
              </select>
            </div>

            <div class="form-group">
              <label>Pa√≠s:</label>
              <input 
                type="text" 
                formControlName="pais"
                class="form-control">
            </div>
          </div>

          <div class="form-group">
            <label>Calle y N√∫mero:</label>
            <input 
              type="text" 
              formControlName="calle"
              placeholder="Calle Principal 123"
              class="form-control">
            
            <div class="error" *ngIf="direccion.get('calle')?.invalid && direccion.get('calle')?.touched">
              <small>‚ö†Ô∏è M√≠nimo 5 caracteres</small>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Ciudad:</label>
              <input 
                type="text" 
                formControlName="ciudad"
                placeholder="Madrid"
                class="form-control">
              
              <div class="error" *ngIf="direccion.get('ciudad')?.invalid && direccion.get('ciudad')?.touched">
                <small>‚ö†Ô∏è M√≠nimo 2 caracteres</small>
              </div>
            </div>

            <div class="form-group">
              <label>C√≥digo Postal:</label>
              <input 
                type="text" 
                formControlName="codigoPostal"
                placeholder="28001"
                maxlength="5"
                class="form-control">
              
              <div class="error" *ngIf="direccion.get('codigoPostal')?.invalid && direccion.get('codigoPostal')?.touched">
                <small>‚ö†Ô∏è Formato: 5 d√≠gitos (Ej: 28001)</small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <button 
        type="button" 
        (click)="agregarDireccion()"
        class="btn-add">
        ‚ûï Agregar Otra Direcci√≥n
      </button>
    </div>

    <!-- ============================================ -->
    <!-- RESUMEN DEL PERFIL -->
    <!-- ============================================ -->
    <div class="resumen" *ngIf="generarResumen()">
      <h3>üìä Resumen del Perfil</h3>
      <div class="resumen-content">
        <p>{{ generarResumen() }}</p>
      </div>
    </div>

    <!-- Bot√≥n Guardar -->
    <button 
      type="submit" 
      [disabled]="perfilForm.invalid"
      class="btn-submit">
      üíæ Guardar Perfil Completo
    </button>
  </form>

  <!-- Estado del formulario (para debugging) -->
  <div class="form-status" *ngIf="!perfilForm.valid">
    <p>‚ö†Ô∏è Completa todos los campos requeridos antes de guardar</p>
  </div>
</div>