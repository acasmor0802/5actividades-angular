<div class="container">
  <h2>ğŸ” Registro Avanzado con ValidaciÃ³n AsincrÃ³nica</h2>
  <p class="subtitle">Actividad 4: Validadores AsÃ­ncronos</p>

  <form [formGroup]="registroForm" (ngSubmit)="onSubmit()">
    
    <!-- Campo Username -->
    <div class="form-group">
      <label for="username">Username:</label>
      <input 
        type="text" 
        id="username"
        formControlName="username"
        class="form-control"
        placeholder="Ej: usuario123">
      
      <!-- Indicador de carga -->
      <div class="loading" *ngIf="mostrarCargando('username')">
        â³ Verificando disponibilidad...
      </div>
      
      <!-- Errores de validaciÃ³n -->
      <div class="error" *ngIf="validarCampo('username')">
        <small *ngIf="registroForm.get('username')?.errors?.['required']">âš ï¸ Requerido</small>
        <small *ngIf="registroForm.get('username')?.errors?.['minlength']">âš ï¸ MÃ­nimo 3 caracteres</small>
        <small *ngIf="registroForm.get('username')?.errors?.['usernameReservado']">
          âš ï¸ Username no disponible (reservado para administradores)
        </small>
      </div>

      <!-- Mensaje de Ã©xito -->
      <div class="success" *ngIf="registroForm.get('username')?.valid && registroForm.get('username')?.touched">
        <small>âœ… Username disponible</small>
      </div>
    </div>

    <!-- Campo Email -->
    <div class="form-group">
      <label for="email">Email:</label>
      <input 
        type="email" 
        id="email"
        formControlName="email"
        class="form-control"
        placeholder="ejemplo@correo.com">
      
      <!-- Indicador de carga -->
      <div class="loading" *ngIf="mostrarCargando('email')">
        â³ Verificando disponibilidad del email...
      </div>
      
      <!-- Errores de validaciÃ³n -->
      <div class="error" *ngIf="validarCampo('email')">
        <small *ngIf="registroForm.get('email')?.errors?.['required']">âš ï¸ Requerido</small>
        <small *ngIf="registroForm.get('email')?.errors?.['email']">âš ï¸ Email invÃ¡lido</small>
        <small *ngIf="registroForm.get('email')?.errors?.['emailExiste']">
          âš ï¸ Este email ya estÃ¡ registrado
        </small>
      </div>

      <!-- Mensaje de Ã©xito -->
      <div class="success" *ngIf="registroForm.get('email')?.valid && registroForm.get('email')?.touched">
        <small>âœ… Email disponible</small>
      </div>

      <!-- Info adicional -->
      <div class="info" *ngIf="registroForm.get('email')?.pending">
        ğŸ” Validando disponibilidad del email...
      </div>
    </div>

    <!-- Campo ContraseÃ±a -->
    <div class="form-group">
      <label for="password">ContraseÃ±a:</label>
      <input 
        type="password" 
        id="password"
        formControlName="password"
        class="form-control"
        placeholder="MÃ­nimo 8 caracteres">
      
      <div class="error" *ngIf="validarCampo('password')">
        <small *ngIf="registroForm.get('password')?.errors?.['required']">âš ï¸ Requerida</small>
        <small *ngIf="registroForm.get('password')?.errors?.['minlength']">âš ï¸ MÃ­nimo 8 caracteres</small>
      </div>

      <!-- Indicador de fortaleza -->
      <div class="password-strength" *ngIf="registroForm.get('password')?.value">
        <div class="strength-bar" 
             [class.weak]="registroForm.get('password')?.value.length < 8"
             [class.medium]="registroForm.get('password')?.value.length >= 8 && registroForm.get('password')?.value.length < 12"
             [class.strong]="registroForm.get('password')?.value.length >= 12">
        </div>
        <small>
          Fortaleza: 
          <span *ngIf="registroForm.get('password')?.value.length < 8">DÃ©bil ğŸ”´</span>
          <span *ngIf="registroForm.get('password')?.value.length >= 8 && registroForm.get('password')?.value.length < 12">Media ğŸŸ¡</span>
          <span *ngIf="registroForm.get('password')?.value.length >= 12">Fuerte ğŸŸ¢</span>
        </small>
      </div>
    </div>

    <!-- Campo TÃ©rminos -->
    <div class="form-group checkbox-group">
      <label>
        <input 
          type="checkbox" 
          formControlName="terminos">
        Acepto los tÃ©rminos y condiciones
      </label>
      
      <div class="error" *ngIf="registroForm.get('terminos')?.invalid && registroForm.get('terminos')?.touched">
        <small>âš ï¸ Debes aceptar los tÃ©rminos</small>
      </div>
    </div>

    <!-- BotÃ³n Submit -->
    <button 
      type="submit" 
      [disabled]="registroForm.invalid || enviando || registroForm.pending"
      class="btn-submit">
      <span *ngIf="!enviando">âœ¨ Crear Cuenta</span>
      <span *ngIf="enviando">â³ Registrando...</span>
    </button>

    <!-- Info de validaciÃ³n en progreso -->
    <div class="validation-info" *ngIf="registroForm.pending">
      <p>ğŸ”„ Validando informaciÃ³n con el servidor...</p>
    </div>
  </form>

  <!-- Panel informativo -->
  <div class="info-panel">
    <h3>â„¹ï¸ InformaciÃ³n de ValidaciÃ³n</h3>
    <ul>
      <li>ğŸ“§ <strong>Emails registrados:</strong> admin@example.com, usuario@example.com, test@example.com</li>
      <li>ğŸš« <strong>Usernames reservados:</strong> Los que empiezan con "admin"</li>
      <li>â±ï¸ <strong>Tiempo de validaciÃ³n:</strong> 0.8-1 segundo (simulado)</li>
    </ul>
  </div>
</div>